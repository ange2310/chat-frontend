<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug AuthClient - Diagn√≥stico Espec√≠fico</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <style>
        .debug-console {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .error { color: #ff4444; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
        .info { color: #44aaff; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6">
            <h1 class="text-3xl font-bold mb-6">üîç AuthClient Debug Console</h1>
            
            <!-- Status Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-900 border border-blue-700 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-300">Ruta del Archivo</h3>
                    <p id="filePathStatus" class="text-blue-100">Verificando...</p>
                </div>
                <div class="bg-green-900 border border-green-700 rounded-lg p-4">
                    <h3 class="font-semibold text-green-300">Carga del Script</h3>
                    <p id="scriptLoadStatus" class="text-green-100">Verificando...</p>
                </div>
                <div class="bg-yellow-900 border border-yellow-700 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-300">Sintaxis</h3>
                    <p id="syntaxStatus" class="text-yellow-100">Verificando...</p>
                </div>
                <div class="bg-purple-900 border border-purple-700 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-300">Funcionalidad</h3>
                    <p id="functionalityStatus" class="text-purple-100">Verificando...</p>
                </div>
            </div>

            <!-- Debug Console -->
            <div class="debug-console" id="debugConsole">
                <div class="success">üü¢ AuthClient Debug Console iniciado...</div>
                <div class="info">üìÇ Directorio actual: <span id="currentPath">Detectando...</span></div>
            </div>

            <!-- Test Buttons -->
            <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">
                <button onclick="testPath1()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm">
                    Test ./assets/
                </button>
                <button onclick="testPath2()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm">
                    Test ../assets/
                </button>
                <button onclick="testPath3()" class="bg-yellow-600 text-white px-3 py-2 rounded hover:bg-yellow-700 text-sm">
                    Test Full Path
                </button>
                <button onclick="testContent()" class="bg-purple-600 text-white px-3 py-2 rounded hover:bg-purple-700 text-sm">
                    Test Content
                </button>
                <button onclick="manualLoad()" class="bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700 text-sm">
                    Manual Load
                </button>
                <button onclick="clearConsole()" class="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 text-sm">
                    Clear
                </button>
            </div>

            <!-- Manual Script Test -->
            <div class="bg-gray-700 rounded-lg p-4 mb-6">
                <h3 class="font-semibold mb-3">üß™ Manual Script Test</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Test URL:</label>
                        <input type="text" id="customPath" value="assets/js/auth-client.js" 
                               class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded text-white">
                    </div>
                    <div class="flex items-end">
                        <button onclick="testCustomPath()" class="w-full bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
                            Test Custom Path
                        </button>
                    </div>
                </div>
            </div>

            <!-- File Content Inspector -->
            <div class="bg-gray-700 rounded-lg p-4">
                <h3 class="font-semibold mb-3">üìÑ File Content Inspector</h3>
                <textarea id="fileContent" rows="10" 
                          class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-green-400 font-mono text-xs"
                          placeholder="El contenido del archivo aparecer√° aqu√≠..."></textarea>
                <div class="mt-2 text-xs text-gray-400">
                    <span id="fileStats">Archivo no cargado</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de logging mejorado
        function debugLog(message, type = 'info') {
            const console = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `${timestamp} - ${message}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }

        // Detectar directorio actual
        function detectCurrentPath() {
            const currentPath = window.location.pathname;
            document.getElementById('currentPath').textContent = currentPath;
            debugLog(`üìÇ Ruta actual: ${currentPath}`, 'info');
            
            // Detectar si estamos en la ra√≠z o en un subdirectorio
            if (currentPath.includes('/public/')) {
                debugLog('üí° Detectado: Estamos en /public/ directory', 'warning');
                document.getElementById('customPath').value = './assets/js/auth-client.js';
            } else if (currentPath === '/' || currentPath.endsWith('.html')) {
                debugLog('üí° Detectado: Estamos en root directory', 'info');
                document.getElementById('customPath').value = 'public/assets/js/auth-client.js';
            }
        }

        // Capturar errores espec√≠ficos de carga de scripts
        window.addEventListener('error', function(e) {
            if (e.target && e.target.tagName === 'SCRIPT') {
                debugLog(`üö® SCRIPT ERROR: ${e.target.src}`, 'error');
                debugLog(`üìÅ Error tipo: ${e.type}`, 'error');
                document.getElementById('scriptLoadStatus').innerHTML = '‚ùå Error de carga';
                
                if (e.target.src.includes('auth-client.js')) {
                    document.getElementById('filePathStatus').innerHTML = '‚ùå Ruta incorrecta';
                }
            } else {
                debugLog(`üö® GENERAL ERROR: ${e.message}`, 'error');
                if (e.message.includes('Unexpected token')) {
                    document.getElementById('syntaxStatus').innerHTML = '‚ùå Error de sintaxis';
                }
            }
        });

        // Test de diferentes rutas
        function testPath1() {
            debugLog('üß™ Testing: ./assets/js/auth-client.js', 'info');
            loadScript('./assets/js/auth-client.js', 'Path 1');
        }

        function testPath2() {
            debugLog('üß™ Testing: ../assets/js/auth-client.js', 'info');
            loadScript('../assets/js/auth-client.js', 'Path 2');
        }

        function testPath3() {
            debugLog('üß™ Testing: /practicas/chat-frontend/public/assets/js/auth-client.js', 'info');
            loadScript('/practicas/chat-frontend/public/assets/js/auth-client.js', 'Path 3');
        }

        function testCustomPath() {
            const customPath = document.getElementById('customPath').value;
            debugLog(`üß™ Testing custom path: ${customPath}`, 'info');
            loadScript(customPath, 'Custom');
        }

        // Funci√≥n gen√©rica para cargar scripts
        function loadScript(src, testName) {
            debugLog(`üì° Intentando cargar ${testName}: ${src}`, 'info');
            
            const script = document.createElement('script');
            script.src = src;
            script.dataset.testName = testName;
            
            script.onload = function() {
                debugLog(`‚úÖ ${testName} cargado exitosamente!`, 'success');
                document.getElementById('scriptLoadStatus').innerHTML = `‚úÖ ${testName} OK`;
                
                // Verificar si AuthClient est√° disponible
                setTimeout(() => {
                    if (typeof AuthClient !== 'undefined') {
                        debugLog('‚úÖ AuthClient clase disponible!', 'success');
                        document.getElementById('syntaxStatus').innerHTML = '‚úÖ Sintaxis OK';
                        testAuthClientFunctionality();
                    } else {
                        debugLog('‚ùå AuthClient no est√° definido despu√©s de cargar', 'error');
                        document.getElementById('syntaxStatus').innerHTML = '‚ùå Clase no definida';
                    }
                }, 100);
            };
            
            script.onerror = function(e) {
                debugLog(`‚ùå ${testName} fall√≥ al cargar`, 'error');
                debugLog(`üìÅ URL completa: ${this.src}`, 'error');
                document.getElementById('scriptLoadStatus').innerHTML = `‚ùå ${testName} Error`;
            };
            
            document.head.appendChild(script);
        }

        // Test de funcionalidad de AuthClient
        function testAuthClientFunctionality() {
            try {
                debugLog('üß™ Testing AuthClient functionality...', 'info');
                
                const authClient = new AuthClient();
                debugLog('‚úÖ AuthClient instance created', 'success');
                
                const debugInfo = authClient.getDebugInfo();
                debugLog('‚úÖ getDebugInfo() works', 'success');
                debugLog(`üìä Debug info: ${JSON.stringify(debugInfo, null, 2)}`, 'info');
                
                document.getElementById('functionalityStatus').innerHTML = '‚úÖ Funcional';
                
                // Test de m√©todos espec√≠ficos
                if (typeof authClient.validateEmail === 'function') {
                    const emailTest = authClient.validateEmail('test@test.com');
                    debugLog(`‚úÖ validateEmail test: ${emailTest}`, 'success');
                }
                
                if (typeof authClient.showNotification === 'function') {
                    authClient.showNotification('Test notification', 'success', 2000);
                    debugLog('‚úÖ showNotification test: OK', 'success');
                }
                
            } catch (error) {
                debugLog(`‚ùå AuthClient functionality error: ${error.message}`, 'error');
                debugLog(`üìÑ Stack: ${error.stack}`, 'error');
                document.getElementById('functionalityStatus').innerHTML = '‚ùå Error funcional';
            }
        }

        // Cargar contenido del archivo para inspecci√≥n
        function testContent() {
            const path = document.getElementById('customPath').value;
            debugLog(`üìÑ Intentando leer contenido de: ${path}`, 'info');
            
            fetch(path)
                .then(response => {
                    debugLog(`üì° Response status: ${response.status}`, response.ok ? 'success' : 'error');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(content => {
                    debugLog(`‚úÖ Archivo le√≠do exitosamente`, 'success');
                    debugLog(`üìä Tama√±o: ${content.length} caracteres`, 'info');
                    
                    document.getElementById('fileContent').value = content.substring(0, 2000) + 
                        (content.length > 2000 ? '\n\n... (archivo truncado para visualizaci√≥n)' : '');
                    
                    document.getElementById('fileStats').textContent = 
                        `Tama√±o: ${content.length} chars | L√≠neas: ${content.split('\n').length}`;
                    
                    // Verificar sintaxis b√°sica
                    checkSyntax(content);
                })
                .catch(error => {
                    debugLog(`‚ùå Error leyendo archivo: ${error.message}`, 'error');
                    document.getElementById('fileContent').value = `Error: ${error.message}`;
                });
        }

        // Verificar sintaxis del archivo
        function checkSyntax(content) {
            debugLog('üîç Verificando sintaxis del archivo...', 'info');
            
            try {
                // Verificar caracteres problem√°ticos
                if (content.includes('\uFEFF')) {
                    debugLog('‚ö†Ô∏è BOM detectado al inicio del archivo', 'warning');
                }
                
                // Verificar balance de llaves y par√©ntesis
                const openBraces = (content.match(/\{/g) || []).length;
                const closeBraces = (content.match(/\}/g) || []).length;
                const openParens = (content.match(/\(/g) || []).length;
                const closeParens = (content.match(/\)/g) || []).length;
                
                debugLog(`üîç Balance de llaves: ${openBraces} abiertas, ${closeBraces} cerradas`, 
                         openBraces === closeBraces ? 'success' : 'error');
                debugLog(`üîç Balance de par√©ntesis: ${openParens} abiertos, ${closeParens} cerrados`, 
                         openParens === closeParens ? 'success' : 'error');
                
                // Buscar patrones problem√°ticos
                const problematicPatterns = [
                    { pattern: /}\s*}/g, name: 'Doble llave de cierre' },
                    { pattern: /,\s*}/g, name: 'Coma antes de llave de cierre' },
                    { pattern: /{\s*,/g, name: 'Coma despu√©s de llave de apertura' }
                ];
                
                problematicPatterns.forEach(({pattern, name}) => {
                    const matches = content.match(pattern);
                    if (matches) {
                        debugLog(`‚ö†Ô∏è ${name} encontrado: ${matches.length} occurrencias`, 'warning');
                    }
                });
                
                document.getElementById('syntaxStatus').innerHTML = '‚úÖ Sintaxis verificada';
                
            } catch (error) {
                debugLog(`‚ùå Error verificando sintaxis: ${error.message}`, 'error');
                document.getElementById('syntaxStatus').innerHTML = '‚ùå Error de sintaxis';
            }
        }

        // Carga manual paso a paso
        function manualLoad() {
            debugLog('üõ†Ô∏è Iniciando carga manual paso a paso...', 'info');
            
            // Lista de rutas a probar
            const pathsToTry = [
                './assets/js/auth-client.js',
                '../assets/js/auth-client.js',
                'assets/js/auth-client.js',
                '/assets/js/auth-client.js',
                'public/assets/js/auth-client.js',
                '/public/assets/js/auth-client.js',
                '/practicas/chat-frontend/public/assets/js/auth-client.js'
            ];
            
            let currentIndex = 0;
            
            function tryNextPath() {
                if (currentIndex >= pathsToTry.length) {
                    debugLog('‚ùå Todas las rutas fallaron', 'error');
                    return;
                }
                
                const path = pathsToTry[currentIndex];
                debugLog(`üîÑ Probando ruta ${currentIndex + 1}/${pathsToTry.length}: ${path}`, 'info');
                
                const script = document.createElement('script');
                script.src = path;
                
                script.onload = function() {
                    debugLog(`‚úÖ ¬°√âXITO! Ruta correcta: ${path}`, 'success');
                    document.getElementById('filePathStatus').innerHTML = '‚úÖ Ruta encontrada';
                    
                    setTimeout(() => {
                        if (typeof AuthClient !== 'undefined') {
                            testAuthClientFunctionality();
                        }
                    }, 100);
                };
                
                script.onerror = function() {
                    debugLog(`‚ùå Ruta ${currentIndex + 1} fall√≥: ${path}`, 'error');
                    currentIndex++;
                    setTimeout(tryNextPath, 500);
                };
                
                document.head.appendChild(script);
            }
            
            tryNextPath();
        }

        function clearConsole() {
            document.getElementById('debugConsole').innerHTML = '<div class="success">üü¢ Console limpiada</div>';
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üü¢ Debug console inicializada', 'success');
            detectCurrentPath();
            
            // Auto-test despu√©s de 1 segundo
            setTimeout(() => {
                debugLog('üöÄ Iniciando auto-diagn√≥stico...', 'info');
                manualLoad();
            }, 1000);
        });
    </script>
</body>
</html>